import{r as B,a as L,w as m,o as M,b as i,c,d as t,e as h,f as b,u as v,F as N,g as T,t as u,h as A,v as D,i as x,j as g,k as F,l as y}from"./app-CvGfV4CC.js";import $ from"./SelectDriver-XMG75miA.js";import S from"./ChatMessages-DH7YUvNK.js";const H={class:"flex h-screen overflow-hidden"},I={class:"w-1/4 bg-white border-r border-gray-300"},O={class:"p-4 border-b border-gray-300 flex justify-between items-center bg-indigo-600 text-white"},K=t("h1",{class:"text-2xl justify-center font-semibold"},"LaraChain",-1),P={class:"overflow-y-auto h-screen p-3 mb-9 pb-20"},q={class:"flex items-center mb-4 cursor-pointer overflow-hidden hover:bg-gray-100 p-2 rounded-md"},z={class:"w-12 h-12 bg-gray-300 rounded-full mr-3"},G=["src"],J={class:"flex-2"},Q={class:"text-lg font-semibold"},R={key:0,class:"text-gray-600 truncate w-1/2"},W={key:0,class:"flex-1"},X={class:"flex bg-white p-4 text-gray-700 border-b border-gray-300"},Y={class:"flex-1 text-2xl font-semibold"},Z={class:"flex-2"},ee=t("h2",{class:"text-lg font-semibold"}," Delete ",-1),te=[ee],se=t("div",{id:"anchor"},null,-1),ae={class:"bg-white border-t border-gray-300 p-4 absolute bottom-0 w-3/4"},oe={class:"flex items-center"},ne={__name:"Chat",props:{chats:Object,chat:Object,messages:Array,active_llms:Array},setup(r){const d=r;let w=B();const s=L({input:"",chat:d.chat,messages:d.messages,streamed_messages:[],show_typing:!1});m(()=>{var e;return(e=s.chat)==null?void 0:e.chat_driver},e=>{V(s.chat)}),m(()=>{var e;return(e=s.chat)==null?void 0:e.id},e=>{j()}),m(()=>s.messages,e=>{n()},{deep:!0});const C=e=>{e.key==="Enter"&&p()},k=e=>{g.delete(route("guest.delete.chat",{chat:e.id}))},V=e=>{g.patch(route("guest.update.chat",{chat:e.id}),e)},p=()=>{s.input!==""&&(n(),g.post(route("guest.chats.messages",{chat:d.chat.id}),{input:s.input},{preserveState:!0,onBefore:()=>{s.input="",n()},onFinish:()=>{s.input="",n()}}))},n=()=>{const e=document.getElementById("scroller");e.scrollTop=e.scrollHeight+e.clientHeight},j=()=>{let e="chat."+d.chat.id;Echo.channel(e).stopListening(".update"),Echo.leaveChannel(e)},E=()=>{let e="chat."+d.chat.id;Echo.channel(e).listen(".MessageCreated",a=>{console.log("MessageCreated",a),_(a.model)}).listen(".MessageUpdated",a=>{console.log("MessageUpdated",a),_(a.model)})},_=(e,a=!1)=>{if(s.messages.find(l=>l.id===e.id))s.messages=s.messages.map(l=>l.id===e.id?e:l);else{let l=!1;a?l=!0:s.streamed_messages.filter(U=>U.body===e.body).length>0||(l=!0),l&&s.messages.push(e)}n()};return M(()=>{n(),d.chat&&E(),setInterval(()=>{},2)}),(e,a)=>(i(),c("div",H,[t("div",I,[t("header",O,[K,h(v(y),{href:e.route("guest.chats.new")},{default:b(()=>[F("New Chat")]),_:1},8,["href"])]),t("div",P,[(i(!0),c(N,null,T(r.chats.data,o=>(i(),c("div",q,[h(v(y),{href:e.route("guest.chats.index",{chat:o.id}),class:"flex-1 flex"},{default:b(()=>{var l,f;return[t("div",z,[t("img",{src:"https://placehold.co/200x/2e83ad/ffffff.svg?text="+o.chat_driver,alt:"User Avatar",class:"w-12 h-12 rounded-full"},null,8,G)]),t("div",J,[t("h2",Q,u(o.title),1),o.messages.length>0?(i(),c("p",R,u(((l=o.messages[0])==null?void 0:l.role)==="assistant"?"TwAi":"User")+": "+u((f=o.messages[0])==null?void 0:f.body),1)):x("",!0)])]}),_:2},1032,["href"])]))),256))])]),r.chat?(i(),c("div",W,[t("header",X,[t("h1",Y,u(r.chat.title),1),t("div",Z,[h($,{modelValue:s.chat.chat_driver,"onUpdate:modelValue":a[0]||(a[0]=o=>s.chat.chat_driver=o),active_llms:r.active_llms},null,8,["modelValue","active_llms"])]),t("div",{class:"flex-3",onClick:a[1]||(a[1]=o=>k(r.chat))},te)]),t("div",{ref_key:"scroller",ref:w,id:"scroller",class:"h-screen justify-end overflow-y-auto p-4 pb-44 scroll-smooth"},[h(S,{messages:s.messages},null,8,["messages"]),se],512),t("footer",ae,[t("div",oe,[A(t("input",{"onUpdate:modelValue":a[2]||(a[2]=o=>s.input=o),class:"w-full p-2 text-2xl text-black rounded-md border border-gray-400 focus:outline-none focus:border-blue-500",placeholder:"Type a message...",type:"text",onKeydown:C},null,544),[[D,s.input]]),t("button",{class:"bg-indigo-500 text-2xl text-white px-4 py-2 rounded-md ml-2",onClick:a[3]||(a[3]=o=>p())}," Send ")])])])):x("",!0)]))}};export{ne as default};
